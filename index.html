<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body ng-app="myapp" class="">
    
    <div class="rounded-bottom-1 shadow bg-white" ng-controller="headerController">
        <nav class="navbar navbar-expand-lg border-secondary border-opacity-50" >
            <div class="container">
                <a class="navbar-brand" href="#!home">
                    <img src="image/logoblack.svg" alt="logo">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav w-100 d-flex justify-content-end position-relative">
                        <li class="nav-item me-2">
                            <a class="btn text-black" data-bs-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
                                <img src="https://d1785e74lyxkqq.cloudfront.net/_next/static/v2/a/a3478fc6e57b8681609c1458bd50cbb9.svg" alt="">
                                VI | VNĐ
                            </a>
                            <div class="collapse position-absolute w-50 start-0 rounded-2 z-3" id="collapseExample">
                                <div class="container row ">
                                    <div class="col col-sm-7 card border border-end rounded-start-2 rounded-end-0 p-1">
                                        <strong class=" ps-3">Quốc gia và ngôn ngữ</strong>
                                        <div data-bs-spy="scroll" data-bs-target="#navbar-example2" data-bs-root-margin="0px 0px -40%" data-bs-smooth-scroll="true" class="scrollspy-example bg-body-tertiary p-0" tabindex="0">
                                            <ul class="list-group p-0 border-0 rounded-0">
                                                <li class="list-group-item border-0 ps-3">
                                                    <img src="https://d1785e74lyxkqq.cloudfront.net/_next/static/v2/2/225a4c290e89ee22a80b21c45e12dd1e.svg" alt="" class="border border-primary rounded-circle">
                                                    <Strong>Indonesia</Strong>
                                                </li>
                                                <li class="list-group-item border-0 ps-3">
                                                    <img src="https://d1785e74lyxkqq.cloudfront.net/_next/static/v2/2/274f148e89a1be9911f97aa57203b6e9.svg" alt="" class="border border-primary rounded-circle">
                                                    <Strong>Global</Strong>
                                                </li>
                                                <li class="list-group-item border-0 ps-3">
                                                    <img src="https://d1785e74lyxkqq.cloudfront.net/_next/static/v2/a/a3478fc6e57b8681609c1458bd50cbb9.svg" alt="" class="border border-primary rounded-circle">
                                                    <Strong>Việt Nam</Strong>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="col col-sm-5 card border border-end rounded-end-2 rounded-start-0 p-1">
                                        <strong class=" ps-3">Tiền tệ</strong>
                                        <div data-bs-spy="scroll" data-bs-target="#navbar-example2" data-bs-root-margin="0px 0px -40%" data-bs-smooth-scroll="true" class="scrollspy-example bg-body-tertiary p-0" tabindex="0">
                                            <ul class="list-group p-0 border-0 rounded-0">
                                                <li class="list-group-item border-0 ps-3">
                                                    <Strong><span class="text-black">VND</span> <span class="text-secondary">Việt Nam Đồng</span></Strong>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </li>
                        <li class="nav-item me-2">
                                <a class="nav-link text-black" href="#!discount">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-id="IcMarketingPromoBadge"><circle cx="12" cy="12" r="10" stroke="#0194f3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></circle><path d="M8.5 17.5L15.5 6.5C15.5 6.5 14 8.00002 12 8.00002C10 8.00002 8 7.05 8 7.05M8 7.00002V7.00002C9.10457 7.00002 10 7.89545 10 9.00002V9.00002C10 10.1046 9.10457 11 8 11V11C6.89543 11 6 10.1046 6 9.00002V9.00002C6 7.89545 6.89543 7.00002 8 7.00002V7.00002ZM18 15V15C18 16.1046 17.1046 17 16 17V17C14.8954 17 14 16.1046 14 15V15C14 13.8954 14.8954 13 16 13V13C17.1046 13 18 13.8954 18 15Z" stroke="#91EC00" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                                    Khuyến mãi
                                </a>
                        </li>
                        <li class="nav-item me-2">
                            <a class="nav-link text-black" href="#!support">
                                Hỗ trợ
                            </a>
                        </li>
                        <li class="nav-item me-2">
                            <a class="nav-link text-black" href="#!coop">
                                Hợp tác
                            </a>
                        </li>
                        <li class="nav-item me-2">
                            <a class="nav-link text-black" href="#!booking">
                                Đặt chỗ
                            </a>
                        </li>
                        <li class="nav-item me-2">
                            <a class="nav-link text-black" href="#!cart">
                                Giỏ hàng
                            </a>
                        </li>
                        <li class="nav-item me-2" ng-hide="isLoggedIn()">
                            <button class="btn border text-black" data-bs-toggle="modal" data-bs-target="#login">
                                <i class="bi bi-person-fill"></i>
                                Đăng nhập
                            </button>
                        </li>
                        <li class="nav-item" ng-hide="isLoggedIn()">
                            <button class="btn btn-primary text-white" data-bs-toggle="modal" data-bs-target="#signup">
                                Đăng ký
                            </button>
                        </li>
                        <li class="nav-item me-2" ng-show="isLoggedIn()">
                            <button class="btn border text-black" data-bs-toggle="modal" data-bs-target="#changepassword">
                                Đổi mật khẩu
                            </button>
                        </li>
                        <li class="nav-item" ng-show="isLoggedIn()">
                            <button class="btn btn-primary text-white" data-bs-toggle="modal" data-bs-target="#forgetpassword" ng-click="logout()">
                                Đăng xuất
                            </button>
                        </li>
                        <div class="modal fade" id="signup" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <form class="modal-content" name="signupform">
                                    <div class="modal-header border-0">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Đăng ký</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body border-0">
                                    <div class="form-group mb-2">
                                        <label for="">Email</label>
                                        <input type="email" class="form-control" placeholder="yourname@email.com" name="email" ng-model="email" required>
                                        <small class="text-danger"><span ng-show="signupform.email.$invalid">Không đúng định dạng email</span></small>
                                    </div>
                                    <div class="form-group mb-2">
                                        <label for="">Số điện thoại</label>
                                        <input type="text" class="form-control" placeholder="012345678" name="phonenumber" ng-model="phonenumber" required pattern="^0\d{9,10}$">
                                        <small class="text-danger"><span ng-show="signupform.phonenumber.$invalid">Không đúng định dạng số điện thoại</span></small>
                                    </div>
                                    
                                    <div class="form-group mb-2">
                                        <label for="">Mật khẩu</label>
                                        <input type="password" class="form-control" placeholder="" name="password" ng-model="password" required minlength="6">
                                        <small class="text-danger"><span ng-show="signupform.password.$invalid">Mật khẩu ít nhất 6 ký tự</span></small>
                                    </div>
                                    
                                    <div class="form-group mb-2">
                                        <label for="">Nhập lại mật khẩu</label>
                                        <input type="password" class="form-control" placeholder="" name="confirmpassword" ng-model="confirmpassword" required minlength="6">
                                        <small class="text-danger"><span ng-show="signupform.confirmpassword.$invalid">Xác nhận mật khẩu ít nhất 6 ký tự</span></small>
                                    </div>
                                    <div class="form-group mb-2">
                                        <label for="">Quốc gia</label>
                                        <select class="form-control" ng-model="nation" ng-options="nation.name for nation in nations"></select>
                                    </div>
                                    <div class="form-group mb-2">
                                        <div class="radio">
                                            <label class="me-2">Giới Tính:</label>
                                            <label><input type="radio" ng-model="gender" value="male"> Nam </label>
                                            <label><input type="radio" ng-model="gender" value="female"> Nữ </label>
                                        </div>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="" id="getnotification" name="getnotification" ng-model="getnotification">
                                        <label class="form-check-label" for="getnotification">
                                            Nhận thông báo
                                        </label>
                                    </div>
                                    <div class="form-group mt-3">
                                        <button class="btn btn-primary w-100" ng-click="signup()">Tiếp tục</button>
                                    </div>
                                    <h6 class="text-center text-secondary mt-3">hoặc đăng nhập/đăng ký với</h6>
                                    <div class="form-group mt-3">
                                        <button class="btn btn-default border border-primary d-flex justify-content-center w-100 text-primary fw-medium">
                                            <img src="image/google.png" alt="" class="me-3 align-self-center">
                                            Tiếp tục với Google
                                        </button>
                                    </div>
                                    <div class="form-group mt-3">
                                        <button class="btn btn-default border border-primary d-flex justify-content-center w-100 text-primary fw-medium">
                                            <img src="image/facebook.png" alt="" class="me-3 align-self-center">
                                            Tiếp tục với Facebook
                                        </button>
                                    </div>
                                    </div>
                                    <div class="modal-footer border-0">
                                        <p class="fw-medium text-center">
                                            Bằng cách đăng ký, bạn đồng ý với <span class="text-primary">Điều khoản & Điều kiện</span> của chúng tôi và bạn đã đọc <span class="text-primary">Chính Sách Quyền Riêng Tư</span> Của của chúng tôi.
                                        </p>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="modal fade" id="login" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <form class="modal-content" name="loginform">
                                    <div class="modal-header border-0">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Đăng nhập</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body border-0">
                                    <div class="form-group mb-2">
                                        <label for="">Số điện thoại</label>
                                        <input type="text" class="form-control" placeholder="012345678" name="phonenumber" ng-model="phonenumber" required pattern="^0\d{9,10}$">
                                        <small class="text-danger"><span ng-show="loginform.phonenumber.$invalid">Không đúng định dạng số điện thoại</span></small>
                                    </div>
                                    
                                    <div class="form-group mb-2">
                                        <label for="">Mật khẩu</label>
                                        <input type="password" class="form-control" placeholder="" name="password" ng-model="password" required minlength="6">
                                        <small class="text-danger"><span ng-show="loginform.password.$invalid">Mật khẩu ít nhất 6 ký tự</span></small>
                                    </div>
                                    <div class="form-group mt-3">
                                        <button class="btn btn-primary w-100" ng-click="login()">Tiếp tục</button>
                                    </div>
                                    <h6 class="text-center text-secondary mt-3">hoặc đăng nhập/đăng ký với</h6>
                                    <div class="form-group mt-3">
                                        <button class="btn btn-default border border-primary d-flex justify-content-center w-100 text-primary fw-medium">
                                            <img src="image/google.png" alt="" class="me-3 align-self-center">
                                            Tiếp tục với Google
                                        </button>
                                    </div>
                                    <div class="form-group mt-3">
                                        <button class="btn btn-default border border-primary d-flex justify-content-center w-100 text-primary fw-medium">
                                            <img src="image/facebook.png" alt="" class="me-3 align-self-center">
                                            Tiếp tục với Facebook
                                        </button>
                                    </div>
                                    </div>
                                    <div class="modal-footer border-0">
                                        <p class="fw-medium text-center">
                                            Bằng cách đăng ký, bạn đồng ý với <span class="text-primary">Điều khoản & Điều kiện</span> của chúng tôi và bạn đã đọc <span class="text-primary">Chính Sách Quyền Riêng Tư</span> Của của chúng tôi.
                                        </p>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="modal fade" id="changepassword" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <form class="modal-content" name="forgetform">
                                    <div class="modal-header border-0">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Đổi mật khẩu</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body border-0">
                                    <div class="form-group mb-2">
                                        <label for="">Mật khẩu cũ</label>
                                        <input type="password" class="form-control" placeholder="" name="oldpassword" ng-model="oldpassword" required minlength="6">
                                        <small class="text-danger"><span ng-show="forgetform.oldpassword.$invalid">Mật khẩu ít nhất 6 ký tự</span></small>
                                    </div>
                                    <div class="form-group mb-2">
                                        <label for="">Nhập lại mật khẩu cũ</label>
                                        <input type="password" class="form-control" placeholder="" name="confirmoldpassword" ng-model="confirmoldpassword" required minlength="6">
                                        <small class="text-danger"><span ng-show="forgetform.confirmoldpassword.$invalid">Mật khẩu ít nhất 6 ký tự</span></small>
                                    </div>
                                    <div class="form-group mb-2">
                                        <label for="">Mật khẩu mới</label>
                                        <input type="password" class="form-control" placeholder="" name="newpassword" ng-model="newpassword" required minlength="6">
                                        <small class="text-danger"><span ng-show="forgetform.newpassword.$invalid">Mật khẩu ít nhất 6 ký tự</span></small>
                                    </div>
                                    
                                    <div class="form-group mt-3">
                                        <button class="btn btn-primary w-100" ng-click="changepassword()">Tiếp tục</button>
                                    </div>
                                    <h6 class="text-center text-secondary mt-3">hoặc đăng nhập/đăng ký với</h6>
                                    <div class="form-group mt-3">
                                        <button class="btn btn-default border border-primary d-flex justify-content-center w-100 text-primary fw-medium">
                                            <img src="image/google.png" alt="" class="me-3 align-self-center">
                                            Tiếp tục với Google
                                        </button>
                                    </div>
                                    <div class="form-group mt-3">
                                        <button class="btn btn-default border border-primary d-flex justify-content-center w-100 text-primary fw-medium">
                                            <img src="image/facebook.png" alt="" class="me-3 align-self-center">
                                            Tiếp tục với Facebook
                                        </button>
                                    </div>
                                    </div>
                                    <div class="modal-footer border-0">
                                        <p class="fw-medium text-center">
                                            Bằng cách đăng ký, bạn đồng ý với <span class="text-primary">Điều khoản & Điều kiện</span> của chúng tôi và bạn đã đọc <span class="text-primary">Chính Sách Quyền Riêng Tư</span> Của của chúng tôi.
                                        </p>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </ul>
                </div>
            </div>
        </nav>
        <nav class="navbar navbar-expand-lg border-secondary border-opacity-50">
            <div class="container">
                <ul class="navbar-nav w-100">
                    <li class="nav-item me-2">
                            <a class="nav-link text-secondary" href="#">
                                <strong>Khách sạn</strong>
                            </a>
                    </li>
                    <li class="nav-item me-2">
                        <a class="nav-link text-secondary" href="#">
                            <strong>Vé máy bay</strong>
                        </a>
                    </li>
                    <li class="nav-item me-2">
                        <a class="nav-link text-secondary" href="#">
                            <strong>Vé xe khách</strong>
                        </a>
                    </li>
                    <li class="nav-item me-2">
                        <a class="nav-link text-secondary" href="#">
                            <strong>Đưa đón sân bay</strong>
                        </a>
                    </li>
                    <li class="nav-item me-2">
                        <a class="nav-link text-secondary" href="#">
                            <strong>Hoạt động & vui chơi</strong>
                        </a>
                    </li>
                    <li class="dropdown nav-item me-2">
                        <button class="btn text-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <Strong>More</Strong>
                        </button>
                        <ul class="dropdown-menu">
                            <li class="dropdown-item text-secondary">
                                <i class="bi bi-airplane-fill"></i>
                                <strong>
                                    Combo tiết kiệm
                                </strong>
                            </li>
                            <li class="dropdown-item text-secondary">
                                <strong>
                                    <i class="bi bi-airplane-fill"></i>
                                    Bảo hiểm du lịch
                                </strong>
                            </li>
                            <li class="dropdown-item text-secondary">
                                <strong>
                                    <i class="bi bi-gift-fill"></i>
                                    Combo quà tặng
                                </strong>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
    </div>
    <article>
        <div ng-view>

        </div>
    </article>
    <div ng-include="'footer.html'"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="js/angular.js"></script>
    <script src="js/angular-route.js"></script>
    <script src="js/bootstrap.bundle.js"></script>
    <script src="js/jquery-3.7.1.js"></script>
    <script>
        'use strict';
        var app = angular.module('myapp', ["ngRoute"]);
        app.config(function($routeProvider) {
            $routeProvider
            .when("/home", {
                templateUrl: "home.html",
                controller: "bodyController"
                
            })
            .when("/discount", {
                templateUrl: "discount.html",
                controller: "bodyController"
                
            })
            .when("/support", {
                templateUrl: "support.html",
                controller: "bodyController"
                
            })
            .when("/coop", {
                templateUrl: "coop.html",
                controller: "bodyController"
                
            })
            .when("/booking", {
                templateUrl: "booking.html",
                controller: "bodyController"
                
            })
            .when("/hotelsearch", {
                templateUrl: "hotelsearch.html",
                controller: "bodyController"
                
            })
            .when("/hoteldetail/:hotel_id", {
                templateUrl: "hoteldetail.html",
                controller: "bodyController"
                
            })
            .when("/cart", {
                templateUrl: "cart.html",
                controller: "bodyController"
                
            })
            .otherwise({
                templateUrl: "home.html",
                controller: "bodyController"
                
            });
        });

        app.controller("bodyController",function ($scope, $rootScope, $routeParams, $http) {
                
                $http.get("http://localhost:3000/hotelfeatures").then(function (reponse) {
                    $scope.hotelfeatures = reponse.data;
                });
                
                $http.get("http://localhost:3000/hotelpromoinfos").then(function (reponse) {
                    $scope.hotelpromoinfos = reponse.data;
                });
                
                $http.get("http://localhost:3000/hotelamenities").then(function (reponse) {
                    $scope.hotelamenities = reponse.data;
                });

                $scope.products = [];          
                $http.get("http://localhost:3000/hotels").then(function (reponse) {
                    $scope.hotels = reponse.data;
                    $scope.detailhotel = $scope.hotels.find(hotel=>hotel.id==$routeParams.hotel_id);
                    $scope.detailhotelamenities = [];

                    $scope.detailhotel.amenities.forEach(function(id) {
                        var amenity = $scope.hotelamenities.find(function(amenity) {
                            return amenity.id == id;
                        });
                        if (amenity) {
                            $scope.detailhotelamenities.push({
                                name: amenity.name,
                                image: amenity.image
                            });
                        }
                    });
                });

                
                $scope.prop = "-price";
                    $scope.sortBy = function(prop) {
                    $scope.prop = prop;
                }

                $scope.filterByPrice = function(hotel) {
                    if (!$scope.minPrice && !$scope.maxPrice) {
                        return true;
                    }
                    if ($scope.minPrice && hotel.price < $scope.minPrice) {
                        return false;
                    }
                    if ($scope.maxPrice && hotel.price > $scope.maxPrice) {
                        return false;
                    }
                    return true;
                };


                $scope.getHotelById = function(id) {
                    return $scope.hotels.find(function(hotel) {
                        return hotel.id == id;
                    });
                }

                $scope.getCurrentDate = function(add) {
                    var today = new Date();
                    today.setDate(today.getDate() + add);
                    return today;
                };
                $scope.getDate = function(date, add = 0) {
                    date = new Date(date);
                    date.setDate(date.getDate() + add);
                    return date.toISOString().split('T')[0];
                }

                $scope.getDateDifference = function(datein, dateout) {
                    
                    var checkin = new Date(datein);
                    var checkout = new Date(dateout);
                    var differenceInTime = checkout - checkin;
                    var differenceInDays = differenceInTime / (1000 * 3600 * 24);
                    console.log(differenceInDays);
                    return Math.round(differenceInDays);
                }

                $scope.getTotalPrice = function() {
                    var price = 0;
                    $rootScope.cart.forEach(function(item) {
                        if (item.selected) {
                            price += item.price * $scope.getDateDifference(item.checkindate, item.checkoutdate);
                        }
                    });
                    return price;
                }

                $scope.countCart = function() {
                    var count = 0;
                    $rootScope.cart.forEach(function(item) {
                        if (item.selected) {
                            count++;
                        }
                    });
                    return count;
                }

            $scope.addtocart = function (id) {
                if (!$rootScope.cart) {
                    $rootScope.cart = [];
                }
                if ($rootScope.cart.length == 0) {
                    $rootScope.cart.push($scope.getHotelById(id));
                    alert("Đã thêm vào giỏ hàng");
                }
                else  {
                    var contain = false;
                    $rootScope.cart.forEach(function (hotel) {
                        if (hotel.id == id) {
                            contain = true;
                        }
                    });
                    if (contain) {
                        alert('Bạn đã thêm khách sạn này rồi!');
                    } else {
                        $rootScope.cart.push($scope.getHotelById(id));
                        alert("Đã thêm vào giỏ hàng");
                    }
                }
            };
            $scope.deleteincart = function(id) {
                var index = $rootScope.cart.findIndex(hotel => hotel.id == id);
                if (index !== -1) {
                    $rootScope.cart.splice(index, 1);
                }
            }
        });
        app.controller("headerController",function ($scope, $rootScope, $routeParams, $http) {
            $scope.nations = [
                    {
                        name: "Việt Nam",
                        currency:"VND"
                    },
                    {
                        name: "Indonesia",
                        currency:"IRD"
                    },
                    {
                        name: "Malaysia",
                        currency:"MYR"
                    }
                ];
            $scope.nation = $scope.nations[0];

            $scope.loggeduser = null;
            $scope.isLoggedIn = function() {
                return ($scope.loggeduser ? true : false);
            }

            function hashPassword(password) {
                return CryptoJS.SHA256(password).toString();
            }
            $scope.logout = function() {
                $scope.loggeduser = null;
            }

            $scope.changepassword = function() {
                var usersarr = JSON.parse(localStorage.getItem("users"));
                if (!usersarr) {
                    alert("Sai số điện thoại hoặc mật khẩu");
                }
                var contain = false;
                usersarr.forEach(function(user) {
                    user = JSON.parse(user);
                    if (user.phonenumber == $scope.phonenumber) {
                        contain = true;
                        const hashedPassword = hashPassword($scope.oldpassword);
                        if ($scope.oldpassword != $scope.confirmoldpassword) {
                            alert("Mật khẩu và xác nhận mật khẩu không giống");
                        }
                        if (user.password == hashedPassword) {

                            usersarr = usersarr.filter(obj => obj.phonenumber == user.phonenumber);
                            user.password = hashPassword($scope.newpassword);
                            usersarr.push(user);
                            $scope.loggeduser = user;
                            localStorage.setItem("users", JSON.stringify(usersarr));
                            alert("Đổi mật khẩu thành công!");
                        } else {
                            alert("Sai mật khẩu");
                        }
                    }
                });
                if (!contain) {
                    alert("Sai số điện thoại hoặc mật khẩu");
                }
                console.log($scope.loggeduser);
            }

            $scope.login = function() {
                var usersarr = JSON.parse(localStorage.getItem("users"));
                if (!usersarr) {
                    alert("Sai số điện thoại hoặc mật khẩu");
                }
                var contain = false;
                if (usersarr) {
                    usersarr.forEach(function(user) {
                   
                    if (user.phonenumber == $scope.phonenumber) {
                        contain = true;
                        const hashedPassword = hashPassword($scope.password);
                        if (user.password == hashedPassword) {
                            $scope.loggeduser = user;
                            alert("Đăng nhập thành công!");
                        } else {
                            alert("Sai mật khẩu");
                        }
                    }
                });
                }
                if (!contain) {
                    alert("Sai số điện thoại hoặc mật khẩu");
                }
                console.log($scope.loggeduser);
            }

            $scope.signup = function() {
                var usersarr = JSON.parse(localStorage.getItem("users"));
                if (!usersarr) {
                    usersarr = [];
                }
                var valid = true;
                usersarr.forEach(function(user) {
                    if (user.email == $scope.email) {
                        alert("Email đã được sử dụng");
                        valid = false;
                    }
                    if (user.phonenumber == $scope.phonenumber) {
                       alert("Số điện thoại đã được sử dụng");
                        valid = false;
                    }
                    if ($scope.password != $scope.confirmpassword) {
                        alert("Mật khẩu và xác nhận mật khẩu không giống");
                        valid = false;
                    }
                });
                if (valid) {
                    const hashedPassword = hashPassword($scope.password);
                    $scope.loggeduser = {
                        "email": $scope.email,
                        "phonenumber": $scope.phonenumber,
                        "password": hashedPassword
                    }
                    usersarr.push($scope.loggeduser);
                    localStorage.setItem("users", JSON.stringify(usersarr));
                    alert("Đăng ký thành công");
                    console.log($scope.loggeduser);
                }
            }
        });

        app.run(function($rootScope) {
            $rootScope.$on("routeChangeStart", function() {
                $rootScope.loading = true;
            });
            $rootScope.$on("routeChangeSuccess", function() {
                $rootScope.loading = false;
            });
            $rootScope.$on("routeChangeError", function() {
                $rootScope.loading = false;
                alert("Không tải được template");
            });
        });

        app.filter('round', function() {
            return function(input) {
                return Math.round(input);
            };
        });
    </script>
</body>
</html>